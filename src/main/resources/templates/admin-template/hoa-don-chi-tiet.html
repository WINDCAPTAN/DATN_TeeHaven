<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Tee Haven</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <link href="../../../static/img/logo_teehaven.png" rel="icon">
    <link href="../../../static/img/apple-touch-icon.png" rel="apple-touch-icon">


    <!-- Favicons -->
    <div th:replace="~{admin-template/fragment/header :: header}"></div>


</head>

<body>

<!-- ======= Header ======= -->
<header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
        <a href="/ban-hang-tai-quay/hoa-don" class="logo d-flex align-items-center">
            <img src="../../../static/img/logo_teehaven.png" alt="">
            <span class="d-none d-lg-block">Tee Haven</span>
        </a>
        <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->


</header><!-- End Header -->

<!-- ======= Sidebar ======= -->
<aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">
        <li class="nav-item">
            <a class="nav-link collapsed" href="/admin/thong-ke">
                <i class="bi bi-graph-up-arrow"></i>
                <span>Thống Kê</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link collapsed" href="/ban-hang-tai-quay/hoa-don">
                <i class="bi bi-shop"></i>
                <span>Bán Hàng</span>
            </a>
        </li><!-- End Dashboard Nav -->

        <li class="nav-item">
            <a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-menu-button-wide"></i><span>Quản Lý Sản Phẩm</span><i
                    class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="components-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                <li>
                    <a href="/admin/san-pham-chi-tiet">
                        <i class="bi bi-circle"></i><span>Sản Phẩm Chi Tiết</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/san-pham">
                        <i class="bi bi-circle"></i><span>Sản Phẩm</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/thuong-hieu">
                        <i class="bi bi-circle"></i><span>Thương Hiệu</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/tay-ao">
                        <i class="bi bi-circle"></i><span>Tay áo</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/mau-sac">
                        <i class="bi bi-circle"></i><span>Màu Sắc</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/kich-co">
                        <i class="bi bi-circle"></i><span>Kích Cỡ</span>
                    </a>
                </li>
            </ul>
        </li><!-- End Components Nav -->

        <li class="nav-item">
            <a class="nav-link collapsed" href="/ban-hang-tai-quay/hoa-don/quan-ly">
                <i class="bi bi-receipt-cutoff"></i>
                <span>Quản Lý Hóa Đơn</span>
            </a>
        </li><!-- End Forms Nav -->

        <li class="nav-item">
            <a class="nav-link" data-bs-target="#tables-nav" data-bs-toggle="collapse" href="#">
                <i class="bi bi-person-vcard"></i><span>Quản Lý Tài Khoản</span><i
                    class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="tables-nav" class="nav-content collapse show" data-bs-parent="#sidebar-nav">
                <li>
                    <a href="/admin/nhan-vien">
                        <i class="bi bi-circle"></i><span>Quản lý nhân viên</span>
                    </a>
                </li>
                <li>
                    <a href="/admin/khach-hang" class="active">
                        <i class="bi bi-circle"></i><span>Quản lý khách hàng</span>
                    </a>
                </li>
            </ul>
        </li><!-- End Tables Nav -->

        <li class="nav-item">
            <a class="nav-link collapsed" href="../admin/voucher">
                <i class="bi bi-ticket-perforated-fill"></i>
                <span>Quản Lý Voucher</span>
            </a>
        </li><!-- End Icons Nav -->
    </ul>

</aside><!-- End Sidebar-->

<main id="main" class="main">
    <section class="section">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="m-0">Danh sách hóa đơn</h5>
                            <div class="tao-hd">
                                <a th:if="${listHoaDon.size() < 5}" id="postLink" class="btn btn-success">Tạo Hóa
                                    đơn</a>
                                <button th:if="${listHoaDon.size() >= 5}" type="button" class="btn btn-success"
                                        data-bs-toggle="modal" data-bs-target="#error5HoaDon">Tạo Hóa đơn
                                </button>

                                <!-- Modal -->
                                <div class="modal fade" id="error5HoaDon" tabindex="-1" role="dialog"
                                     aria-labelledby="modalTitleId" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="modalTitleId">Thông báo</h5>
                                            </div>
                                            <div class="modal-body">
                                                <div style="text-align: center;" class="container-fluid">
                                                    Bạn chỉ có thể tạo tối đa 5 hóa đơn!
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Đóng
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <script>
                                    document.getElementById("postLink").addEventListener("click", function (event) {
                                        event.preventDefault(); // Ngăn chặn thực hiện mặc định của thẻ <a>

                                        var form = document.createElement("form");
                                        form.method = "POST";
                                        form.action = "/ban-hang-tai-quay/hoa-don/add"; // Đặt URL mà bạn muốn gửi yêu cầu POST đến

                                        var input = document.createElement("input");
                                        input.type = "hidden";
                                        input.name = "key";
                                        input.value = "value"; // Dữ liệu bạn muốn gửi

                                        form.appendChild(input);

                                        document.body.appendChild(form);
                                        form.submit();
                                    });
                                </script>
                            </div>
                        </div>
                        <div class="tab-pane fade show active" id="tao-moi" role="tabpanel"
                             aria-labelledby="tao-moi-tab">
                            <div class="hoa-don">
                                <div th:each="hd : ${listHoaDon}" class="btn-group" role="group"
                                     aria-label="Basic outlined example">
                                    <a th:text="${hd.maHoaDon}"
                                       th:href="@{'/ban-hang-tai-quay/hoa-don/' + ${hd.id}}"
                                       class="btn btn-outline-primary"></a>
                                </div>
                            </div>
                        </div>

                        <div th:if="${hoaDon.trangThai !=-1}">
                            <h1 style="text-align: center;">[[${hoaDon.maHoaDon}]] - Chờ thanh toán</h1>
                            <a class="btn btn-link" style="float: left;margin-top: 1%;"
                               href="/ban-hang-tai-quay/hoa-don/quan-ly">
                                <i class=" bi bi-arrow-left-circle-fill"></i>
                            </a>
                        </div>
                        <div class="d-flex justify-content-end align-items-center" style="margin-top: 1%;">
                            <button onclick="handleButtonClick()" type="button"
                                    class="btn btn-primary" data-bs-toggle="modal"
                                    th:data-bs-target="${'#addsp'+hoaDon.id}">
                                Thêm sản phẩm
                            </button>
                        </div>

                        <!-- Table Sản Phẩm-->
                        <div class="table-ban-hang">
                            <table class="sanpham-table">
                                <thead>
                                <tr>
                                    <th scope="col">STT</th>
                                    <th scope="col">Sản phẩm</th>
                                    <th scope="col">Số lượng</th>
                                    <th scope="col">Thành tiền</th>
                                    <th scope="col"
                                        th:if="${hoaDon.trangThai!=2&&hoaDon.trangThai!=5}">
                                        Thao tác
                                    </th>

                                </tr>
                                </thead>
                                <tbody>


                                <tr th:each="obj, state:${hoaDon.lstHoaDonChiTiet}">

                                    <form th:id="${'myForm'+obj.id}"
                                          action="/ban-hang-tai-quay/hoa-don-chi-tiet/update"
                                          method="post">

                                        <th scope="row" th:text="${state.index+1}"></th>
                                        <td>
                                            <div class="row">
                                                <div class="col-4">
                                                    <img th:src="@{'../../../static/img/ImgShoe/' + ${obj.ChiTietSanPham.SanPham.listHinhAnhSanPham[0].url}}"
                                                         class="fixed-image">
                                                </div>

                                                <div class="col-8">
                                                    <div class="info-price">
                                                        <h6>[[${obj.ChiTietSanPham.SanPham.ten}]]
                                                            [
                                                            [[${obj.ChiTietSanPham.MauSac.ten}]]
                                                            -
                                                            [[${obj.ChiTietSanPham.KichCo.ten}]]
                                                            ]
                                                        </h6>
                                                        <span>Đơn giá: <span class="gia">
                                                                                        [[${obj.donGia}]]
                                                                                        VND</span></span>
                                                        <p>Tay áo:
                                                            [[${obj.ChiTietSanPham.TayAo.ten}]]
                                                        </p>
                                                        <span
                                                                th:if="${obj.soLuong>obj.ChiTietSanPham.soLuong}"
                                                                style="color: rgb(208, 255, 0); font-weight: bold;background-color: red;">Số
                                                                                    lượng còn:
                                                                                    [[${obj.ChiTietSanPham.soLuong}]]</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            [[${obj.soLuong}]]
                                        </td>

                                        <td>
                                            <div class="price-table">
                                                [[${obj.tongTien()}]] VND
                                            </div>
                                        </td>


                                        <td
                                                th:if="${hoaDon.trangThai!=2&&hoaDon.trangThai!=3&&hoaDon.trangThai!=5}">
                                            <div class="button-table">
                                                <!-- delete Hóa đơn chi tiết -->

                                                <!-- Button trigger modal -->

                                                <button type="button" class="btn btn-primary"
                                                        th:data-bs-toggle="modal"
                                                        th:data-bs-target="${'#modalEditSoLuong'+obj.id}">
                                                    Sửa
                                                    <input type="hidden" name="idHdct"
                                                           th:value="${obj.id}">
                                                </button>

                                                <!-- Modal update sl-->
                                                <div class="modal fade"
                                                     th:id="${'modalEditSoLuong'+obj.id}"
                                                     tabindex="-1"
                                                     aria-labelledby="exampleModalLabel"
                                                     aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h1 class="modal-title fs-5"
                                                                    id="exampleModalLabel">Nhập
                                                                    số lượng</h1>


                                                            </div>
                                                            <div class="modal-body">
                                                                <p>(Sẵn
                                                                    [[${obj.ChiTietSanPham.soLuong}]]
                                                                    sản phẩm )</p>
                                                                <input type="number"
                                                                       name="soLuongEdit"
                                                                       th:id="${'soLuongEdit'+obj.id}">

                                                            </div>
                                                            <small
                                                                    id="errorSoLuongEdit"></small>
                                                            <div class="modal-footer">
                                                                <button type="button"
                                                                        class="btn btn-secondary"
                                                                        data-bs-dismiss="modal">Đóng
                                                                </button>
                                                                <button
                                                                        th:onclick="'validateAndSubmit('+${obj.ChiTietSanPham.soLuong}+','+${obj.ChiTietSanPham.soLuong}+','+${obj.id}+')'"
                                                                        type="button"
                                                                        class="btn btn-primary">Xác
                                                                    nhận
                                                                </button>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button type="button" class="btn btn-danger"
                                                        th:data-bs-toggle="modal"
                                                        th:data-bs-target="${'#modalDeleteHdct'+obj.id}">
                                                    Xóa
                                                </button>
                                                <div class="modal fade"
                                                     th:id="${'modalDeleteHdct'+obj.id}"
                                                     tabindex="-1" role="dialog"
                                                     aria-labelledby="modalTitleId1"
                                                     aria-hidden="true">
                                                    <div class="modal-dialog" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title"
                                                                    id="modalTitleId1">Xác nhận
                                                                </h5>

                                                            </div>
                                                            <div class="modal-body">
                                                                <div class="container-fluid">
                                                                    Xóa
                                                                    [[${obj.ChiTietSanPham.SanPham.ten}]]
                                                                    ?
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button"
                                                                        class="btn btn-secondary"
                                                                        data-bs-dismiss="modal">Close
                                                                </button>
                                                                <a th:href="@{'/ban-hang-tai-quay/hoa-don-chi-tiet/delete/'+${obj.id}}"
                                                                   class="btn btn-danger">Xóa
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </td>
                                    </form>
                                </tr>


                                </tbody>
                            </table>
                        </div>

                    <div th:if="${#lists.size(hoaDon.lstHoaDonChiTiet) ==0}">
                        <!-- giỏ hàng trống -->
                        <div class="cart-no-product">
                            <div style="margin: auto; margin-bottom: 8%;" class="row">
                                <div class="col-md-12">
                                    <img th:src="@{/static/img/cart.png}" alt="">

                                </div>

                                <div class="col-md-12">
                                    <span style="text-align: center;">Không có sản phẩm nào trong giỏ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--Table Khách Hàng-->
                    <div class="line"></div>

                    <div class="tai-khoan-ban-hang">
                        <div class="row mb-3">
                            <h4 class="col-sm-2" style="font-family: Arial, sans-serif;font-size: 20px;
            font-weight: bold;
            color: black;">Tài khoản</h4>


                            <div class="col-sm-10"
                                 th:if="${hoaDon.trangThai ==-1 || hoaDon.trangThai ==4}">
                                <!---->
                                <button type="button" class="btn btn-primary"
                                        data-bs-toggle="modal" style="float: right;"
                                        data-bs-target="#chonKhachHangModal">

                                    Chọn tài khoản
                                </button>
                            </div>
                            <div class="" th:each=" taiKhoan: ${listTaiKhoan}">

                                <div class="modal fade" th:id="chonKhachHangModal"
                                     tabindex="-1" aria-labelledby="chonKhachHangModalLabel"
                                     aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-5"
                                                    id="chonKhachHangModalLabel">
                                                    Danh sách khách
                                                    hàng
                                                </h1>
                                            </div>
                                            <div class="modal-body">
                                                <!-- form tìm kiếm khách hàng -->
                                                <div class="row mb-3">
                                                    <div class="col-sm-2 offset-10">
                                                        <button type="button"
                                                                class="btn btn-primary"
                                                                data-bs-toggle="modal"
                                                                style="float: right;"
                                                                data-bs-target="#them-khach-hang">
                                                            Thêm mới
                                                        </button>
                                                    </div>
                                                </div>


                                                <!-- table khách hàng -->

                                                <table id="example1" class="display">
                                                    <thead>
                                                    <tr>
                                                        <th>STT</th>
                                                        <th>Tên Khách Hàng</th>
                                                        <th>Số Điện Thoại</th>
                                                        <th>Email</th>
                                                        <th>Hành Động</th>
                                                    </tr>
                                                    <thead>
                                                    <tbody>

                                                    <tr
                                                            th:each=" taiKhoan, state : ${listTaiKhoan}">
                                                        <form
                                                                action="/ban-hang-tai-quay/hoa-don/add-khach-hang"
                                                                method="post">

                                                            <td
                                                                    th:text="${state.index+1}">
                                                            </td>
                                                            <td
                                                                    th:text="${taiKhoan.hoVaTen}">
                                                            </td>
                                                            <td
                                                                    th:text="${taiKhoan.soDienThoai}">
                                                            </td>
                                                            <td
                                                                    th:text="${taiKhoan.email}">
                                                            </td>

                                                            <td>
                                                                <input type="hidden"
                                                                       th:value="${taiKhoan.id}"
                                                                       name="idTaiKhoan">
                                                                <input name="idhdc"
                                                                       type="hidden"
                                                                       th:value="${hoaDon.id}">
                                                                <button
                                                                        type="submit"
                                                                        class="btn btn-success">
                                                                    Chọn
                                                                </button>
                                                            </td>

                                                        </form>
                                                    </tr>

                                                    </tbody>
                                                    <tfoot hidden="hidden">
                                                    <tr>
                                                        <th>STT</th>
                                                        <th>Tên Khách Hàng</th>
                                                        <th>Số Điện Thoại</th>
                                                        <th>Email</th>
                                                        <th>Hành Động</th>
                                                    </tr>
                                                    </tfoot>
                                                </table>


                                            </div>
                                            <div class="modal-footer">

                                                <form
                                                        action="/ban-hang-tai-quay/hoa-don/add-khach-hang"
                                                        method="post">
                                                    <input type="hidden" name="idTaiKhoan"
                                                           value="-1">
                                                    <input name="idhdc" type="hidden"
                                                           th:value="${hoaDon.id}">
                                                    <button type="submit"
                                                            class="btn btn-danger">Bỏ chọn
                                                    </button>
                                                </form>
                                                <button type="button"
                                                        class="btn btn-secondary"
                                                        data-bs-dismiss="modal">Đóng
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Thông tin khách hàng -->
                        <div>
                            <div class="row mb-3">
                                <label class="col-sm-2">Tên khách hàng:</label>
                                <div class="col-sm-6">
                                    <label class="thong-tin-tai-khoan"
                                           th:text="${hoaDon.taiKhoan.hoVaTen}"></label>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <label class="col-sm-2">Số điện thoại:</label>
                                <div class="col-sm-6">
                                    <label class="thong-tin-tai-khoan"
                                           th:text="${hoaDon.taiKhoan.soDienThoai}"></label>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <label class="col-sm-2">Email:</label>
                                <div class="col-sm-6">
                                    <label class="thong-tin-tai-khoan"
                                           th:text="${hoaDon.taiKhoan.email}"></label>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- Modal SP-->
                    <div class="modal fade" th:id="${'addsp'+hoaDon.id}" tabindex="-1"
                         aria-labelledby="themSanPhamLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-body">
                                    <!-- form search -->
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" style="margin: auto;">
                                            Danh sách sản phẩm
                                        </h1>
                                    </div>
                                    <table id="example" class="display">
                                        <thead>
                                        <tr>
                                            <th scope="col">STT</th>
                                            <th scope="col">Sản Phẩm</th>
                                            <th scope="col">Số Lượng</th>
                                            <th scope="col">Giá Bán</th>
                                            <th scope="col">Hành Động</th>
                                        </tr>
                                        <thead>
                                        <tbody>
                                        <tr th:each=" ctsp, state: ${listCtsp}">
                                            <form
                                                    action="/ban-hang-tai-quay/hoa-don-chi-tiet/add"
                                                    method="post">
                                                <!-- input hidden -->
                                                <input th:value="${hoaDon.id}"
                                                       type="hidden" name="idHoaDon">
                                                <input th:value="${ctsp.id}"
                                                       type="hidden" name="idCtsp">

                                                <th scope="row" style="width: 5%;"
                                                    th:text="${state.index+1}"></th>
                                                <td style="width: 50%;">
                                                    <div class="row">
                                                        <div class="col-4"
                                                             th:if="${!#lists.isEmpty(ctsp.hinhAnh)}">
                                                            <img th:src="${ctsp.hinhAnh[0]}"
                                                                 class="fixed-image">
                                                        </div>

                                                        <div class="col-8">
                                                            <div class="info-price">
                                                                <h6>[[${ctsp.SanPham.ten}]]
                                                                    [
                                                                    [[${ctsp.MauSac.ten}]]
                                                                    -
                                                                    [[${ctsp.KichCo.ten}]]
                                                                    ]
                                                                </h6>
                                                                <span>Đơn giá: <span
                                                                        class="gia">
                                                                                                            [[${ctsp.giaHienHanh}]]
                                                                                                            VND</span></span>
                                                                <p>Tay áo:
                                                                    [[${ctsp.TayAo.ten}]]
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    [[${ctsp.soLuong}]]
                                                </td>
                                                <td>
                                                    [[${ctsp.giaHienHanh}]]VND
                                                </td>
                                                <td>

                                                    <button
                                                            th:id="'themSp'+${ctsp.id}"
                                                            type="submit"
                                                            class="btn btn-success">Thêm
                                                    </button>
                                                    <!-- th:onclick="'handleButtonClick(`themSp'+${ctsp.id}+'`)'"  -->
                                                </td>
                                            </form>
                                        </tr>

                                        </tbody>
                                        <tfoot hidden="hidden">
                                        <tr>
                                            <th>STT</th>
                                            <th>Sản Phẩm</th>
                                            <th>Số Lượng</th>
                                            <th>Giá Bán</th>
                                            <th>Hành Động</th>
                                        </tr>
                                        </tfoot>
                                    </table>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Đóng
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>
</main><!-- End #main -->


<!-- ======= Footer ======= -->
<footer id="footer" class="footer">
    <div class="copyright">

    </div>
    <div class="credits">
        Website bán giày Tee Haven
    </div>
</footer><!-- End Footer -->

<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
        class="bi bi-arrow-up-short"></i></a>

<div th:replace="~{admin-template/fragment/script :: script}"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<style>
    .modal-dialog {
        position: relative;
        right: -27%; /* Đẩy modal sang bên phải */
        transform: translateX(0); /* Đảm bảo modal không bị dịch chuyển thêm */
    }
</style>
</body>
</html>